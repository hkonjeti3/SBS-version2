<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <div class="header-actions">
      <button *ngIf="unreadCount > 0" 
              class="btn btn-secondary" 
              (click)="markAllNotificationsAsRead()">
        Mark All as Read ({{ unreadCount }})
      </button>
    </div>
  </div>

  <!-- Error Display -->
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">
    
    <!-- Pending Requests Section (for approvers) -->
    <div *ngIf="isApprover()" class="dashboard-section">
      <h2>Pending Requests ({{ getTotalPendingRequests() }})</h2>
      
      <!-- Account Requests -->
      <div *ngIf="pendingRequests.accountRequests.length > 0" class="request-section">
        <h3>Account Creation Requests</h3>
        <div class="request-grid">
          <div *ngFor="let request of pendingRequests.accountRequests" class="request-card">
            <div class="request-header">
              <h4>Account Request #{{ request.id }}</h4>
              <span class="status pending">Pending</span>
            </div>
            <div class="request-details">
              <p><strong>User:</strong> {{ request.userName || 'User #' + request.userId }}</p>
              <p><strong>Account Type:</strong> {{ request.accountType }}</p>
              <p><strong>Initial Balance:</strong> ${{ request.initialBalance }}</p>
              <p><strong>Reason:</strong> {{ request.reason }}</p>
              <p><strong>Submitted:</strong> {{ formatDate(request.timestamp!) }}</p>
            </div>
            <div class="request-actions">
              <button class="btn btn-success" (click)="approveAccountRequest(request.id!)">
                <i class="fas fa-check"></i> Approve
              </button>
              <button class="btn btn-danger" (click)="rejectAccountRequest(request.id!)">
                <i class="fas fa-times"></i> Reject
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Update Requests -->
      <div *ngIf="pendingRequests.profileRequests.length > 0" class="request-section">
        <h3>Profile Update Requests</h3>
        <div class="request-grid">
          <div *ngFor="let request of pendingRequests.profileRequests" class="request-card">
            <div class="request-header">
              <h4>Profile Update #{{ request.id }}</h4>
              <span class="status pending">Pending</span>
            </div>
            <div class="request-details">
              <p><strong>User:</strong> {{ request.userName || 'User #' + request.userId }}</p>
              <p><strong>Field:</strong> {{ request.requestType }}</p>
              <p><strong>Current Value:</strong> {{ request.currentValue }}</p>
              <p><strong>Requested Value:</strong> {{ request.requestedValue }}</p>
              <p><strong>Reason:</strong> {{ request.reason }}</p>
              <p><strong>Submitted:</strong> {{ formatDate(request.timestamp!) }}</p>
            </div>
            <div class="request-actions">
              <button class="btn btn-success" (click)="approveProfileRequest(request.id!)">
                <i class="fas fa-check"></i> Approve
              </button>
              <button class="btn btn-danger" (click)="rejectProfileRequest(request.id!)">
                <i class="fas fa-times"></i> Reject
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- No Pending Requests -->
      <div *ngIf="getTotalPendingRequests() === 0" class="no-requests">
        <p>No pending requests to review.</p>
      </div>
    </div>

    <!-- Activity Logs Section -->
    <div class="dashboard-section">
      <h2>Activity Logs</h2>
      <div class="activity-list">
        <div *ngFor="let activity of activityLogs" class="activity-item">
          <div class="activity-icon">
            <i class="fas fa-{{ getActivityIcon(activity.action) }}"></i>
          </div>
          <div class="activity-content">
            <div class="activity-header">
              <h4>{{ activity.action }}</h4>
              <span class="activity-time">{{ formatDate(activity.timestamp) }}</span>
            </div>
            <p class="activity-details">{{ activity.description || activity.details }}</p>
            <p *ngIf="activity.actorName || activity.userName" class="activity-actor">
              <small>By: {{ activity.actorName || activity.userName }}</small>
            </p>
          </div>
        </div>
      </div>
      
      <!-- No Activity -->
      <div *ngIf="activityLogs.length === 0" class="no-activity">
        <p>No activity logs available.</p>
      </div>
    </div>

    <!-- Notifications Section -->
    <div class="dashboard-section">
      <h2>Notifications ({{ notifications.length }})</h2>
      <div class="notification-list">
        <div *ngFor="let notification of notifications" 
             class="notification-item"
             [class.unread]="!notification.isRead"
             (click)="markNotificationAsRead(notification.id)">
          <div class="notification-icon">
            <i class="fas fa-bell"></i>
          </div>
          <div class="notification-content">
            <h4>{{ notification.message || notification.title }}</h4>
            <p>{{ notification.description || notification.content }}</p>
            <span class="notification-time">{{ formatDate(notification.timestamp) }}</span>
          </div>
          <div *ngIf="!notification.isRead" class="notification-badge">
            <span class="badge">New</span>
          </div>
        </div>
      </div>
      
      <!-- No Notifications -->
      <div *ngIf="notifications.length === 0" class="no-notifications">
        <p>No notifications available.</p>
      </div>
    </div>
  </div>
</div> 